{% extends "authenticated_base2.html" %}

{% block content %}
<section class="w-full p-2">
    <div class="bg-gray-800/50 rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-bold mb-6">{{ translations.game.quests.edit_quest }}</h2>
        
       <form method="POST" action="{{ url_for('game.edit_quest', quest_id=quest.id) }}">
		   <div class="font-medium">
				{% if quest.translation_key in translations.game.quests %}
					{{ translations.game.quests[quest.translation_key].title }}
				{% else %}
					{{ quest.translation_key }}
				{% endif %}
			</div>
            <div class="mb-4">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.quest_title }}</label>
                <input type="text" name="title" value="{{ quest.title }}" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.quest_description }}</label>
                <textarea name="description" class="w-full bg-gray-700 border border-gray-600 rounded p-2" rows="3" required>{{ quest.description }}</textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" name="is_active" class="mr-2" {% if quest.is_active %}checked{% endif %}>
                        <span>{{ translations.game.quests.is_active }}</span>
                    </label>
                </div>
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" name="is_unique" class="mr-2" {% if quest.is_unique %}checked{% endif %}>
                        <span>{{ translations.game.quests.is_unique }}</span>
                    </label>
                </div>
                <div>
                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.spawn_chance }}</label>
                    <input type="number" name="spawn_chance" min="0.1" max="10" step="0.1" value="{{ quest.spawn_chance }}" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
                </div>
            </div>
            
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">{{ translations.game.quests.objectives }}</h3>
                <div id="objectives-container">
                    {% for objective in quest.objectives %}
                        <div class="bg-gray-700/50 p-4 rounded-lg mb-2">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2">
                                <div>
                                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.objective_type }}</label>
                                    <select name="objectives[{{ loop.index0 }}][type]" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                                        <option value="kill_other_faction">{{ translations.game.quests.kill_other_faction }}</option>
										<option value="kill_enemy_faction">{{ translations.game.quests.kill_enemy_faction }}</option>
										<option value="kill_npc">{{ translations.game.quests.kill_npc }}</option>
										<option value="mine_resources">{{ translations.game.quests.mine_resources }}</option>
										<option value="enter_lottery">{{ translations.game.quests.enter_lottery }}</option>
										<option value="deposit_gold">{{ translations.game.quests.deposit_gold }}</option>
										<option value="withdraw_gold">{{ translations.game.quests.withdraw_gold }}</option>
										<option value="buy_from_store">{{ translations.game.quests.buy_from_store }}</option>
										<option value="buy_specific_item">{{ translations.game.quests.buy_specific_item }}</option>
										<option value="train_attribute">{{ translations.game.quests.train_attribute }}</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.target_value }}</label>
                                    <input type="text" name="objectives[{{ loop.index0 }}][target]" value="{{ objective.target_value }}" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.amount_required }}</label>
                                    <input type="number" name="objectives[{{ loop.index0 }}][amount]" min="1" value="{{ objective.amount_required }}" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                                </div>
                            </div>
                            <button type="button" class="remove-objective bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm">
                                Remover
                            </button>
                        </div>
                    {% endfor %}
                </div>
                <button type="button" id="add-objective" class="bg-gray-700 hover:bg-gray-600 text-white py-1 px-3 rounded text-sm mt-2">
                    {{ translations.game.quests.add_objective }}
                </button>
            </div>
            
            <div class="mb-6">
                <h3 class="text-xl font-bold mb-2">{{ translations.game.quests.rewards }}</h3>
                <div id="rewards-container">
                    {% for reward in quest.rewards %}
                        <div class="bg-gray-700/50 p-4 rounded-lg mb-2">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2">
                                <div>
                                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.reward_type }}</label>
                                    <select name="rewards[{{ loop.index0 }}][type]" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                                        <option value="diamonds">{{ translations.game.quests.diamonds }}</option>
										<option value="xp">{{ translations.game.quests.xp }}</option>
										<option value="gold">{{ translations.game.quests.gold }}</option>
										<option value="reputation">{{ translations.game.quests.reputation }}</option>
										<option value="item">{{ translations.game.quests.item }}</option>
										<option value="lottery_tickets">{{ translations.game.quests.lottery_tickets }}</option>
										<option value="attribute">{{ translations.game.quests.attribute }}</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.amount }}</label>
                                    <input type="number" name="rewards[{{ loop.index0 }}][amount]" min="1" value="{{ reward.amount }}" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                                </div>
                                <div>
                                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.item }}</label>
                                    <input type="text" name="rewards[{{ loop.index0 }}][target]" value="{{ reward.item_id if reward.item_id else '' }}" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
                                </div>
                            </div>
                            <button type="button" class="remove-reward bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm">
                                Remover
                            </button>
                        </div>
                    {% endfor %}
                </div>
                <button type="button" id="add-reward" class="bg-gray-700 hover:bg-gray-600 text-white py-1 px-3 rounded text-sm mt-2">
                    {{ translations.game.quests.add_reward }}
                </button>
            </div>
            
            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                Atualizar Miss√£o
            </button>
        </form>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Add objective
    document.getElementById('add-objective').addEventListener('click', function() {
        const container = document.getElementById('objectives-container');
        const index = container.children.length; // Use current number of children as index

        const div = document.createElement('div');
        div.className = 'bg-gray-700/50 p-4 rounded-lg mb-2';
        div.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2">
                <div>
                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.objective_type }}</label>
                    <select name="objectives[${index}][type]" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                        <option value="kill_other_faction">{{ translations.game.quests.kill_other_faction }}</option>
                        <option value="kill_enemy_faction">{{ translations.game.quests.kill_enemy_faction }}</option>
                        <option value="kill_npc">{{ translations.game.quests.kill_npc }}</option>
                        <option value="mine_resources">{{ translations.game.quests.mine_resources }}</option>
                        <option value="enter_lottery">{{ translations.game.quests.enter_lottery }}</option>
                        <option value="deposit_gold">{{ translations.game.quests.deposit_gold }}</option>
                        <option value="withdraw_gold">{{ translations.game.quests.withdraw_gold }}</option>
                        <option value="buy_from_store">{{ translations.game.quests.buy_from_store }}</option>
                        <option value="buy_specific_item">{{ translations.game.quests.buy_specific_item }}</option>
                        <option value="train_attribute">{{ translations.game.quests.train_attribute }}</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.target_value }}</label>
                    <input type="text" name="objectives[${index}][target]" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
                </div>
                <div>
                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.amount_required }}</label>
                    <input type="number" name="objectives[${index}][amount]" min="1" value="1" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                </div>
            </div>
            <button type="button" class="remove-objective bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm">
                Remover
            </button>
        `;
        container.appendChild(div);
    });

    // Add reward
    document.getElementById('add-reward').addEventListener('click', function() {
        const container = document.getElementById('rewards-container');
        const index = container.children.length; // Use current number of children as index

        const div = document.createElement('div');
        div.className = 'bg-gray-700/50 p-4 rounded-lg mb-2';
        div.innerHTML = `
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-2">
                <div>
                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.reward_type }}</label>
                    <select name="rewards[${index}][type]" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                        <option value="diamonds">{{ translations.game.quests.diamonds }}</option>
                        <option value="xp">{{ translations.game.quests.xp }}</option>
                        <option value="gold">{{ translations.game.quests.gold }}</option>
                        <option value="reputation">{{ translations.game.quests.reputation }}</option>
                        <option value="item">{{ translations.game.quests.item }}</option>
                        <option value="lottery_tickets">{{ translations.game.quests.lottery_tickets }}</option>
                        <option value="attribute">{{ translations.game.quests.attribute }}</option>
                    </select>
                </div>
                <div>
                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.amount }}</label>
                    <input type="number" name="rewards[${index}][amount]" min="1" value="1" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                </div>
                <div>
                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.item }}</label>
                    <input type="text" name="rewards[${index}][item]" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
                </div>
            </div>
            <button type="button" class="remove-reward bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm">
                Remover
            </button>
        `;
        container.appendChild(div);
    });

    // Remove objective/reward
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-objective')) {
            e.target.parentNode.remove();
        }
        if (e.target.classList.contains('remove-reward')) {
            e.target.parentNode.remove();
        }
    });
});
</script>



{% endblock %}
