{% extends "authenticated_base.html" %}

{% block content %}
<div class="admin-container">
    <h2>{{ translations.admin.edit_item }}</h2>
    
    <form method="POST" class="admin-form">
        <div class="form-group">
            <label for="item_type">{{ translations.shop.item_type }}</label>
            <select name="item_type" id="item_type" class="form-control" required>
                <option value="weapon" {% if item.item_type == 'weapon' %}selected{% endif %}>{{ translations.shop.weapon }}</option>
                <option value="armor" {% if item.item_type == 'armor' %}selected{% endif %}>{{ translations.shop.armor }}</option>
            </select>
        </div>
        
        <div class="form-group" id="armor-type-group" {% if item.item_type != 'armor' %}style="display: none;"{% endif %}>
            <label for="armor_type">{{ translations.shop.armor_type }}</label>
            <select name="armor_type" id="armor_type" class="form-control">
                <option value="head" {% if item.armor_type == 'head' %}selected{% endif %}>{{ translations.shop.armor_head }}</option>
                <option value="body" {% if item.armor_type == 'body' %}selected{% endif %}>{{ translations.shop.armor_body }}</option>
                <option value="gloves" {% if item.armor_type == 'gloves' %}selected{% endif %}>{{ translations.shop.armor_gloves }}</option>
                <option value="pants" {% if item.armor_type == 'pants' %}selected{% endif %}>{{ translations.shop.armor_pants }}</option>
                <option value="boots" {% if item.armor_type == 'boots' %}selected{% endif %}>{{ translations.shop.armor_boots }}</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="translation_key">{{ translations.admin.translation_key }}</label>
            <input type="text" name="translation_key" id="translation_key" class="form-control" value="{{ item.translation_key }}" required>
        </div>
        
        <div class="form-group">
            <label for="price">{{ translations.shop.price }}</label>
            <input type="number" name="price" id="price" class="form-control" min="1" value="{{ item.price }}" required>
        </div>
        
        <div class="form-group">
            <label for="min_level">{{ translations.shop.level_required }}</label>
            <input type="number" name="min_level" id="min_level" class="form-control" min="1" value="{{ item.min_level }}" required>
        </div>
        
        <div class="form-group" id="weapon-stats" {% if item.item_type != 'weapon' %}style="display: none;"{% endif %}>
			<label for="dice_count">{{ translations.shop.dice_count or 'Number of Dice' }}</label>
			<input type="number" name="dice_count" id="dice_count" class="form-control" min="1" max="100" value="{{ dice_count }}" required>
			
			<label for="dice_type">{{ translations.shop.dice_type or 'Dice Type' }}</label>
			<select name="dice_type" id="dice_type" class="form-control" required>
				<option value="3" {% if dice_type == 3 %}selected{% endif %}>1d3</option>
				<option value="4" {% if dice_type == 4 %}selected{% endif %}>1d4</option>
				<option value="6" {% if dice_type == 6 %}selected{% endif %}>1d6</option>
				<option value="8" {% if dice_type == 8 %}selected{% endif %}>1d8</option>
				<option value="10" {% if dice_type == 10 %}selected{% endif %}>1d10</option>
				<option value="12" {% if dice_type == 12 %}selected{% endif %}>1d12</option>
				<option value="20" {% if dice_type == 20 %}selected{% endif %}>1d20</option>
			</select>
		</div>
        
        <div class="form-group" id="armor-stats" {% if item.item_type != 'armor' %}style="display: none;"{% endif %}>
            <label for="defense">{{ translations.shop.defense }}</label>
            <input type="number" name="defense" id="defense" class="form-control" min="1" value="{{ item.stats.defense if item.item_type == 'armor' else 1 }}">
            
            <label for="health_bonus">{{ translations.shop.health_bonus }}</label>
            <input type="number" name="health_bonus" id="health_bonus" class="form-control" min="0" value="{{ item.stats.health_bonus if item.item_type == 'armor' else 0 }}">
        </div>
        
			<!-- Add these fields near the end of the form -->
		<div class="form-group">
			<label for="is_npc_only">NPC Only Item</label>
			<input type="checkbox" name="is_npc_only" id="is_npc_only" class="form-control" {% if item.is_npc_only %}checked{% endif %}>
		</div>

		<div class="form-group" id="rare-drop-group" {% if not item.is_npc_only %}style="display: none;"{% endif %}>
			<label for="is_rare_drop">Ultra Rare Monster Drop</label>
			<input type="checkbox" name="is_rare_drop" id="is_rare_drop" class="form-control" {% if item.is_rare_drop %}checked{% endif %}>
			
			<label for="drop_rate">Drop Rate (e.g., 0.00003 for 0.003%)</label>
			<input type="number" name="drop_rate" id="drop_rate" class="form-control" step="0.00001" min="0" max="1" value="{{ item.drop_rate or '0.00003' }}">
		</div>

<script>
// Show rare drop fields only if NPC only is checked
		document.getElementById('is_npc_only').addEventListener('change', function() {
			document.getElementById('rare-drop-group').style.display = this.checked ? 'block' : 'none';
			if (!this.checked) {
				document.getElementById('is_rare_drop').checked = false;
			}
		});
</script>
		
        
        <button type="submit" class="btn btn-primary">{{ translations.admin.save_changes }}</button>
        <a href="{{ url_for('game.manage_items') }}" class="btn btn-secondary">{{ translations.general.cancel }}</a>
    </form>
</div>

<script>
document.getElementById('item_type').addEventListener('change', function() {
    const isArmor = this.value === 'armor';
    document.getElementById('armor-type-group').style.display = isArmor ? 'block' : 'none';
    document.getElementById('armor-stats').style.display = isArmor ? 'block' : 'none';
    document.getElementById('weapon-stats').style.display = isArmor ? 'none' : 'block';
});
</script>

{% endblock %}
