{% extends "authenticated_base2.html" %}

{% block content %}

{% if character.is_dead %}
<div class="bg-red-600 text-white p-4 rounded-lg mb-6">
    {{ translations.game.academy.dead_message }}
</div>
{% endif %}

<section class="w-full p-2">
    <!-- Academy Header -->
    <div class="bg-gray-800/50 rounded-lg p-6 mb-6">
        <div class="flex items-center gap-4 mb-4">
            <img src="{{ url_for('static', filename='images/icons/academia.png') }}" width="50">
            <h1 class="text-2xl font-bold">{{ translations.game.academy.title }}</h1>
        </div>
        
        <div class="mb-4">
            <p class="font-semibold"><span class="text-gray-300">{{ resource_name }}:</span> {{ character.resource }}</p>
        </div>
        
        <div class="text-gray-300 mb-6">
            <p>{{ translations.game.academy.description }}</p>
        </div>
    </div>
    
    {% if training_results %}
    <div class="bg-gray-800/50 rounded-lg p-6 mb-6">
        <h3 class="text-xl font-bold mb-4">{{ translations.game.academy.training_results }}</h3>
        <div class="space-y-3 mb-6">
            {% for result in training_results %}
                <div class="p-3 rounded-lg {% if result.type == 'loss' %}bg-red-900/50{% else %}bg-gray-700/50{% endif %}">
                    {% if result.type == 'gain' %}
                        <p class="flex items-center gap-2">
                            <span class="inline-flex items-center justify-center w-6 h-6 rounded-full 
                                {% if result.quality == 'normal' %}bg-gray-500
                                {% elif result.quality == 'good' %}bg-green-500
                                {% else %}bg-blue-500{% endif %}">
                                {% if result.quality == 'normal' %}âšª{% elif result.quality == 'good' %}ðŸŸ¢{% else %}ðŸ”µ{% endif %}
                            </span>
                            {{ translations.game.academy.you_spent }} {{ result.resources_used }} {{ resource_name.lower() }} {{ translations.game.academy.and_increase }} {{ "%.3f"|format(result.change) }} {{ translations.game.attributes[result.attribute] }}
                        </p>
                    {% else %}
                        <p>{{ translations.game.academy.lost_resource }} {{ "%.3f"|format(-result.change) }} {{ translations.game.attributes[result.attribute] }}</p>
                    {% endif %}
                </div>
            {% endfor %}
        </div>
        
        <div class="bg-gray-700/50 p-4 rounded-lg">
            <p class="mb-2"><strong>{{ translations.game.academy.total_training }}:</strong> {{ "+" if total_change >= 0 else "" }}{{ "%.3f"|format(total_change) }} {{ translations.game.attributes[training_results[0].attribute] }}</p>
            <p><strong>{{ translations.game.academy.training_per_resource }}:</strong> {{ "%.3f"|format(total_change/(resources_to_use//5)) }}</p>
        </div>
    </div>
    {% endif %}
    
    <!-- Training Options -->
    <div class="bg-gray-800/50 rounded-lg p-6 mb-6">
        <form method="POST" id="trainingForm">
            <!-- Attribute Selection -->
            <div class="mb-8">
                <h3 class="text-xl font-bold mb-4">{{ translations.game.academy.choose_attribute }}</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4" id="attributeOptions">
                    <label class="flex flex-col items-center bg-gray-700/50 p-4 rounded-lg hover:bg-gray-600/50 transition-colors cursor-pointer attribute-option">
                        <input type="radio" name="attribute" value="destreza" required class="hidden">
                        <img src="{{ url_for('static', filename='images/status_dex.png') }}" 
                             alt="{{ translations.game.attributes.destreza }}"
                             class="w-12 h-12 mb-2">
                        <span>{{ translations.game.attributes.destreza }}</span>
                    </label>
                    
                    <label class="flex flex-col items-center bg-gray-700/50 p-4 rounded-lg hover:bg-gray-600/50 transition-colors cursor-pointer attribute-option">
                        <input type="radio" name="attribute" value="forca" required class="hidden">
                        <img src="{{ url_for('static', filename='images/status_forca.png') }}" 
                             alt="{{ translations.game.attributes.forca }}"
                             class="w-12 h-12 mb-2">
                        <span>{{ translations.game.attributes.forca }}</span>
                    </label>
                    
                    <label class="flex flex-col items-center bg-gray-700/50 p-4 rounded-lg hover:bg-gray-600/50 transition-colors cursor-pointer attribute-option">
                        <input type="radio" name="attribute" value="inteligencia" required class="hidden">
                        <img src="{{ url_for('static', filename='images/status_int.png') }}" 
                             alt="{{ translations.game.attributes.inteligencia }}"
                             class="w-12 h-12 mb-2">
                        <span>{{ translations.game.attributes.inteligencia }}</span>
                    </label>
                    
                    <label class="flex flex-col items-center bg-gray-700/50 p-4 rounded-lg hover:bg-gray-600/50 transition-colors cursor-pointer attribute-option">
                        <input type="radio" name="attribute" value="devocao" required class="hidden">
                        <img src="{{ url_for('static', filename='images/status_devocao.png') }}" 
                             alt="{{ translations.game.attributes.devocao }}"
                             class="w-12 h-12 mb-2">
                        <span>{{ translations.game.attributes.devocao }}</span>
                    </label>
                </div>
            </div>
            
            <!-- Amount Selection -->
            <div>
                <h3 class="text-xl font-bold mb-4">{{ translations.game.academy.choose_amount }}</h3>
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                    <button type="submit" name="amount" value="5" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors">
                        {{ translations.game.academy.use_5 }} (5)
                    </button>
                    <button type="submit" name="amount" value="10" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors">
                        {{ translations.game.academy.use_10 }} (10)
                    </button>
                    <button type="submit" name="amount" value="50" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors">
                        {{ translations.game.academy.use_50 }} (50)
                    </button>
                    <button type="submit" name="amount" value="all" class="bg-blue-600 hover:bg-blue-700 text-white py-3 px-4 rounded-lg transition-colors">
                        {{ translations.game.academy.use_all }}
                    </button>
                </div>
            </div>
        </form>
    </div>
    
    <!-- Current Stats -->
    <div class="bg-gray-800/50 rounded-lg p-6">
        <h3 class="text-xl font-bold mb-4">{{ translations.game.academy.current_stats }}</h3>
        <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <li class="bg-gray-700/50 p-3 rounded-lg">
                <strong>{{ translations.game.attributes.destreza }}:</strong> 
                {{ "%.3f"|format(character.destreza) }}
            </li>
            <li class="bg-gray-700/50 p-3 rounded-lg">
                <strong>{{ translations.game.attributes.forca }}:</strong> 
                {{ "%.3f"|format(character.forca) }}
            </li>
            <li class="bg-gray-700/50 p-3 rounded-lg">
                <strong>{{ translations.game.attributes.inteligencia }}:</strong> 
                {{ "%.3f"|format(character.inteligencia) }}
            </li>
            <li class="bg-gray-700/50 p-3 rounded-lg">
                <strong>{{ translations.game.attributes.devocao }}:</strong> 
                {{ "%.3f"|format(character.devocao) }}
            </li>
        </ul>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const attributeOptions = document.querySelectorAll('.attribute-option');
    const form = document.getElementById('trainingForm');
    
    // Highlight selected attribute
    attributeOptions.forEach(option => {
        const radio = option.querySelector('input[type="radio"]');
        
        // Highlight on click
        option.addEventListener('click', function() {
            // Remove highlight from all options
            attributeOptions.forEach(opt => {
                opt.classList.remove('bg-blue-600', 'border-blue-400');
                opt.classList.add('bg-gray-700/50');
            });
            
            // Highlight selected option
            this.classList.remove('bg-gray-700/50');
            this.classList.add('bg-blue-600', 'border-blue-400', 'border-2');
        });
        
        // Check if this option was previously selected (after form submission)
        if (radio.checked) {
            option.classList.remove('bg-gray-700/50');
            option.classList.add('bg-blue-600', 'border-blue-400', 'border-2');
        }
    });
    
    // Prevent form submission if no attribute is selected
    form.addEventListener('submit', function(e) {
        const selectedAttribute = form.querySelector('input[name="attribute"]:checked');
        if (!selectedAttribute) {
            e.preventDefault();
            alert('Please select an attribute to train');
        }
    });
});
</script>
{% endblock %}
