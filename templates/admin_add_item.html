{% extends "authenticated_base.html" %}

{% block content %}
<div class="admin-container">
    <h2>{{ translations.admin.add_item }}</h2>
    
    <form method="POST" class="admin-form">
        <div class="form-group">
            <label for="item_type">{{ translations.shop.item_type }}</label>
            <select name="item_type" id="item_type" class="form-control" required>
                <option value="weapon">{{ translations.shop.weapon }}</option>
                <option value="armor">{{ translations.shop.armor }}</option>
            </select>
        </div>
        
        <div class="form-group" id="armor-type-group" style="display: none;">
            <label for="armor_type">{{ translations.shop.armor_type }}</label>
            <select name="armor_type" id="armor_type" class="form-control">
                <option value="head">{{ translations.shop.armor_head }}</option>
                <option value="body">{{ translations.shop.armor_body }}</option>
                <option value="gloves">{{ translations.shop.armor_gloves }}</option>
                <option value="pants">{{ translations.shop.armor_pants }}</option>
                <option value="boots">{{ translations.shop.armor_boots }}</option>
            </select>
        </div>
        
        <div class="form-group">
            <label for="translation_key">{{ translations.admin.translation_key }}</label>
            <input type="text" name="translation_key" id="translation_key" class="form-control" required>
            <small class="form-text text-muted">
                {{ translations.admin.translation_key_help }}
            </small>
        </div>
        
        <div class="form-group">
            <label for="price">{{ translations.shop.price }}</label>
            <input type="number" name="price" id="price" class="form-control" min="1" required>
        </div>
        
        <div class="form-group">
            <label for="min_level">{{ translations.shop.level_required }}</label>
            <input type="number" name="min_level" id="min_level" class="form-control" min="1" value="1" required>
        </div>
        
        <div class="form-group" id="weapon-stats">
			<label for="dice_count">{{ translations.shop.dice_count or 'Number of Dice' }}</label>
			<input type="number" name="dice_count" id="dice_count" class="form-control" min="1" max="100" value="1" required>
			
			<label for="dice_type">{{ translations.shop.dice_type or 'Dice Type' }}</label>
			<select name="dice_type" id="dice_type" class="form-control" required>
				<option value="3">1d3</option>
				<option value="4">1d4</option>
				<option value="6" selected>1d6</option>
				<option value="8">1d8</option>
				<option value="10">1d10</option>
				<option value="12">1d12</option>
				<option value="20">1d20</option>
			</select>
		</div>
        
        <div class="form-group" id="armor-stats" style="display: none;">
            <label for="defense">{{ translations.shop.defense }}</label>
            <input type="number" name="defense" id="defense" class="form-control" min="1" value="1">
            
            <label for="health_bonus">{{ translations.shop.health_bonus }}</label>
            <input type="number" name="health_bonus" id="health_bonus" class="form-control" min="0" value="0">
        </div>
        
        <div class="form-group">
			<label for="required_attribute">{{ translations.admin.required_attribute or 'Required Attribute' }}</label>
			<select name="required_attribute" id="required_attribute" class="form-control">
				<option value="none">{{ translations.admin.none or 'None' }}</option>
				<option value="forca">{{ translations.game.attributes.forca or 'Força' }}</option>
				<option value="destreza">{{ translations.game.attributes.destreza or 'Destreza' }}</option>
				<option value="inteligencia">{{ translations.game.attributes.inteligencia or 'Inteligência' }}</option>
				<option value="devocao">{{ translations.game.attributes.devocao or 'Devoção' }}</option>
			</select>
		</div>

		<div class="form-group">
			<label for="required_amount">{{ translations.admin.required_amount or 'Required Amount' }}</label>
			<input type="number" name="required_amount" id="required_amount" class="form-control" min="0" value="0">
		</div>
		
				<!-- Add these fields near the end of the form, before the submit button -->
		<div class="form-group">
			<label for="is_npc_only">NPC Only Item</label>
			<input type="checkbox" name="is_npc_only" id="is_npc_only" class="form-control">
		</div>

		<div class="form-group" id="rare-drop-group" style="display: none;">
			<label for="is_rare_drop">Ultra Rare Monster Drop</label>
			<input type="checkbox" name="is_rare_drop" id="is_rare_drop" class="form-control">
			
			<label for="drop_rate">Drop Rate (e.g., 0.00003 for 0.003%)</label>
			<input type="number" name="drop_rate" id="drop_rate" class="form-control" step="0.00001" min="0" max="1" value="0.00003">
		</div>

		<script>
		// Show rare drop fields only if NPC only is checked
		document.getElementById('is_npc_only').addEventListener('change', function() {
			document.getElementById('rare-drop-group').style.display = this.checked ? 'block' : 'none';
		});
		</script>
        
        <button type="submit" class="btn btn-primary">{{ translations.admin.save_changes }}</button>
        <a href="{{ url_for('game.manage_items') }}" class="btn btn-secondary">
            {{ translations.get('general', {}).get('cancel', 'Cancel') }}
        </a>
    </form>
</div>

<script>
document.getElementById('item_type').addEventListener('change', function() {
    const isArmor = this.value === 'armor';
    document.getElementById('armor-type-group').style.display = isArmor ? 'block' : 'none';
    document.getElementById('armor-stats').style.display = isArmor ? 'block' : 'none';
    document.getElementById('weapon-stats').style.display = isArmor ? 'none' : 'block';
});
</script>
{% endblock %}
