{% extends "authenticated_base2.html" %}

{% block content %}
<section class="w-full p-2">
    <div class="bg-gray-800/50 rounded-lg p-6 mb-6">
        <h2 class="text-2xl font-bold mb-6">{{ translations.game.quests.add_quest }}</h2>
        
        <form method="POST" action="{{ url_for('game.add_quest') }}">
            <div class="mb-4">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.quest_title }}</label>
                <input type="text" name="title" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.quest_description }}</label>
                <textarea name="description" class="w-full bg-gray-700 border border-gray-600 rounded p-2" rows="3" required></textarea>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-4">
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" name="is_active" class="mr-2" checked>
                        <span>{{ translations.game.quests.is_active }}</span>
                    </label>
                </div>
                <div>
                    <label class="flex items-center">
                        <input type="checkbox" name="is_unique" class="mr-2">
                        <span>{{ translations.game.quests.is_unique }}</span>
                    </label>
                </div>
                <div>
                    <label class="block text-gray-300 mb-2">{{ translations.game.quests.spawn_chance }}</label>
                    <input type="number" name="spawn_chance" min="0" max="100" value="0" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
                </div>
            </div>

            <div class="bg-gray-700/50 rounded-lg p-4 mb-6">
                <h3 class="text-xl font-bold mb-4">{{ translations.game.quests.objectives }}</h3>
                <div id="objectives-container" class="space-y-4 mb-4">
                    </div>
                <button type="button" id="add-objective" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                    {{ translations.game.quests.add_objective }}
                </button>
            </div>

            <div class="bg-gray-700/50 rounded-lg p-4 mb-6">
                <h3 class="text-xl font-bold mb-4">{{ translations.game.quests.rewards }}</h3>
                <div id="rewards-container" class="space-y-4 mb-4">
                    </div>
                <button type="button" id="add-reward" class="bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded">
                    {{ translations.game.quests.add_reward }}
                </button>
            </div>
            
            <div class="mb-4">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.translation_key }}</label>
                <input type="text" name="translation_key" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
            </div>

            
            <button type="submit" class="bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded">
                {{ translations.game.quests.add_quest }}
            </button>
        </form>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const objectivesContainer = document.getElementById('objectives-container');
    const addObjectiveBtn = document.getElementById('add-objective');
    const rewardsContainer = document.getElementById('rewards-container');
    const addRewardBtn = document.getElementById('add-reward');

    let objectiveIndex = 0;
    let rewardIndex = 0;

    addObjectiveBtn.addEventListener('click', function() {
        const div = document.createElement('div');
        div.classList.add('p-3', 'border', 'border-gray-600', 'rounded', 'grid', 'grid-cols-1', 'md:grid-cols-3', 'gap-4');
        div.innerHTML = `
            <div>
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.objective_type }}</label>
                <select name="objectives[${objectiveIndex}][type]" class="objective-type w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                    <option value="">{{ translations.game.quests.select_objective_type }}</option>
                    <option value="kill_other_faction">{{ translations.game.quests.kill_other_faction }}</option>
                    <option value="kill_enemy_faction">{{ translations.game.quests.kill_enemy_faction }}</option>
                    <option value="kill_npc">{{ translations.game.quests.kill_npc }}</option>
                    <option value="mine_resources">{{ translations.game.quests.mine_resources }}</option>
                    <option value="enter_lottery">{{ translations.game.quests.enter_lottery }}</option>
                    <option value="deposit_gold">{{ translations.game.quests.deposit_gold }}</option>
                    <option value="withdraw_gold">{{ translations.game.quests.withdraw_gold }}</option>
                    <option value="buy_from_store">{{ translations.game.quests.buy_from_store }}</option>
                    <option value="buy_specific_item">{{ translations.game.quests.buy_specific_item }}</option>
                    <option value="train_attribute">{{ translations.game.quests.train_attribute }}</option>
                </select>
            </div>
            <div class="objective-target-container hidden">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.target_value }}</label>
                <input type="text" name="objectives[${objectiveIndex}][target]" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
            </div>
            <div class="objective-attribute-container hidden">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.attribute }}</label>
                <select name="objectives[${objectiveIndex}][attribute_type]" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
                    <option value="">{{ translations.game.quests.select_attribute }}</option>
                    <option value="forca">{{ translations.game.academy.forca }}</option>
                    <option value="destreza">{{ translations.game.academy.destreza }}</option>
                    <option value="inteligencia">{{ translations.game.academy.inteligencia }}</option>
                    <option value="devocao">{{ translations.game.academy.devocao }}</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.amount_required }}</label>
                <input type="number" name="objectives[${objectiveIndex}][amount]" min="1" value="1" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
            </div>
            <button type="button" class="remove-objective bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm">
                Remover
            </button>
        `;
        objectivesContainer.appendChild(div);
        objectiveIndex++;
    });

    addRewardBtn.addEventListener('click', function() {
        const div = document.createElement('div');
        div.classList.add('p-3', 'border', 'border-gray-600', 'rounded', 'grid', 'grid-cols-1', 'md:grid-cols-3', 'gap-4');
        div.innerHTML = `
            <div>
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.reward_type }}</label>
                <select name="rewards[${rewardIndex}][type]" class="reward-type w-full bg-gray-700 border border-gray-600 rounded p-2" required>
                    <option value="">{{ translations.game.quests.select_reward_type }}</option>
                    <option value="gold">{{ translations.game.quests.gold }}</option>
                    <option value="diamonds">{{ translations.game.quests.diamonds }}</option>
                    <option value="xp">{{ translations.game.quests.xp }}</option>
                    <option value="reputation">{{ translations.game.quests.reputation }}</option>
                    <option value="item">{{ translations.game.quests.item }}</option>
                    <option value="lottery_tickets">{{ translations.game.quests.lottery_tickets }}</option>
                    <option value="attribute">{{ translations.game.quests.attribute }}</option>
                </select>
            </div>
            <div class="reward-attribute-container hidden">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.attribute }}</label>
                <select name="rewards[${rewardIndex}][attribute_type]" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
                    <option value="">{{ translations.game.quests.select_attribute }}</option>
                    <option value="forca">{{ translations.game.academy.forca }}</option>
                    <option value="destreza">{{ translations.game.academy.destreza }}</option>
                    <option value="inteligencia">{{ translations.game.academy.inteligencia }}</option>
                    <option value="devocao">{{ translations.game.academy.devocao }}</option>
                </select>
            </div>
            <div>
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.amount }}</label>
                <input type="number" name="rewards[${rewardIndex}][amount]" min="1" value="1" class="w-full bg-gray-700 border border-gray-600 rounded p-2" required>
            </div>
            <div class="reward-item-container hidden">
                <label class="block text-gray-300 mb-2">{{ translations.game.quests.item }}</label>
                <input type="text" name="rewards[${rewardIndex}][item]" class="w-full bg-gray-700 border border-gray-600 rounded p-2">
            </div>
            <button type="button" class="remove-reward bg-red-600 hover:bg-red-700 text-white py-1 px-2 rounded text-sm">
                Remover
            </button>
        `;
        rewardsContainer.appendChild(div);
        rewardIndex++;
    });

    // Remove objective/reward
    document.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-objective')) {
            e.target.parentNode.remove();
        }
        if (e.target.classList.contains('remove-reward')) {
            e.target.parentNode.remove();
        }
    });

    document.addEventListener('change', function(e) {
        if (e.target.classList.contains('reward-type')) {
            const container = e.target.closest('.grid');
            const attributeContainer = container.querySelector('.reward-attribute-container');
            const itemContainer = container.querySelector('.reward-item-container');
            
            if (e.target.value === 'attribute') {
                attributeContainer.classList.remove('hidden');
                itemContainer.classList.add('hidden');
            } else if (e.target.value === 'item') {
                attributeContainer.classList.add('hidden');
                itemContainer.classList.remove('hidden');
            } else {
                attributeContainer.classList.add('hidden');
                itemContainer.classList.add('hidden');
            }
        } else if (e.target.classList.contains('objective-type')) {
            const container = e.target.closest('.grid');
            const targetContainer = container.querySelector('.objective-target-container');
            const attributeContainer = container.querySelector('.objective-attribute-container');

            // Hide all by default
            targetContainer.classList.add('hidden');
            attributeContainer.classList.add('hidden');

            if (e.target.value === 'train_attribute') {
                attributeContainer.classList.remove('hidden');
            } else if (['kill_npc', 'buy_from_store', 'buy_specific_item'].includes(e.target.value)) {
                targetContainer.classList.remove('hidden');
            }
        }
    });
});
</script>
{% endblock %}
